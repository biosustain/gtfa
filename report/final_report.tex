%! Author = jason
%! Date = 27/10/21

% Template for PLoS
% Version 3.5 March 2018
%
% % % % % % % % % % % % % % % % % % % % % %
%
% -- IMPORTANT NOTE
%
% This template contains comments intended
% to minimize problems and delays during our production
% process. Please follow the template instructions
% whenever possible.
%
% % % % % % % % % % % % % % % % % % % % % % %
%
% Once your paper is accepted for publication,
% PLEASE REMOVE ALL TRACKED CHANGES in this file
% and leave only the final text of your manuscript.
% PLOS recommends the use of latexdiff to track changes during review, as this will help to maintain a clean tex file.
% Visit https://www.ctan.org/pkg/latexdiff?lang=en for info or contact us at latex@plos.org.
%
%
% There are no restrictions on package use within the LaTeX files except that
% no packages listed in the template may be deleted.
%
% Please do not include colors or graphics in the text.
%
% The manuscript LaTeX source should be contained within a single file (do not use \input, \externaldocument, or similar commands).
%
% % % % % % % % % % % % % % % % % % % % % % %
%
% -- FIGURES AND TABLES
%
% Please include tables/figure captions directly after the paragraph where they are first cited in the text.
%
% DO NOT INCLUDE GRAPHICS IN YOUR MANUSCRIPT
% - Figures should be uploaded separately from your manuscript file.
% - Figures generated using LaTeX should be extracted and removed from the PDF before submission.
% - Figures containing multiple panels/subfigures must be combined into one image file before submission.
% For figure citations, please use "Fig" instead of "Figure".
% See http://journals.plos.org/plosone/s/figures for PLOS figure guidelines.
%
% Tables should be cell-based and may not contain:
% - spacing/line breaks within cells to alter layout or alignment
% - do not nest tabular environments (no tabular environments within tabular environments)
% - no graphics or colored text (cell background color/shading OK)
% See http://journals.plos.org/plosone/s/tables for table guidelines.
%
% For tables that exceed the width of the text column, use the adjustwidth environment as illustrated in the example table in text below.
%
% % % % % % % % % % % % % % % % % % % % % % % %
%
% -- EQUATIONS, MATH SYMBOLS, SUBSCRIPTS, AND SUPERSCRIPTS
%
% IMPORTANT
% Below are a few tips to help format your equations and other special characters according to our specifications. For more tips to help reduce the possibility of formatting errors during conversion, please see our LaTeX guidelines at http://journals.plos.org/plosone/s/latex
%
% For inline equations, please be sure to include all portions of an equation in the math environment.  For example, x$^2$ is incorrect; this should be formatted as $x^2$ (or $\mathrm{x}^2$ if the romanized font is desired).
%
% Do not include text that is not math in the math environment. For example, CO2 should be written as CO\textsubscript{2} instead of CO$_2$.
%
% Please add line breaks to long display equations when possible in order to fit size of the column.
%
% For inline equations, please do not include punctuation (commas, etc) within the math environment unless this is part of the equation.
%
% When adding superscript or subscripts outside of brackets/braces, please group using {}.  For example, change "[U(D,E,\gamma)]^2" to "{[U(D,E,\gamma)]}^2".
%
% Do not use \cal for caligraphic font.  Instead, use \mathcal{}
%
% % % % % % % % % % % % % % % % % % % % % % % %
%
% Please contact latex@plos.org with any questions.
%
% % % % % % % % % % % % % % % % % % % % % % % %

\documentclass[10pt,letterpaper]{article}
\usepackage[top=0.85in,left=2.75in,footskip=0.75in]{geometry}

% amsmath and amssymb packages, useful for mathematical formulas and symbols
\usepackage{amsmath,amssymb}

% Use adjustwidth environment to exceed column width (see example table in text)
\usepackage{changepage}

% Use Unicode characters when possible
\usepackage[utf8x]{inputenc}

% textcomp package and marvosym package for additional characters
\usepackage{textcomp,marvosym}
\usepackage{gensymb}

% cite package, to clean up citations in the main text. Do not remove.
\usepackage{cite}

% Use nameref to cite supporting information files (see Supporting Information section for more info)
\usepackage{nameref,hyperref}

% line numbers
\usepackage[right]{lineno}

% ligatures disabled
\usepackage{microtype}
\DisableLigatures[f]{encoding = *, family = * }

% color can be used to apply background shading to table cells only
\usepackage[table]{xcolor}

% array package and thick rules for tables
\usepackage{array}

% create "+" rule type for thick vertical lines
\newcolumntype{+}{!{\vrule width 2pt}}

% create \thickcline for thick horizontal lines of variable length
\newlength\savedwidth
\newcommand\thickcline[1]{%
  \noalign{\global\savedwidth\arrayrulewidth\global\arrayrulewidth 2pt}%
  \cline{#1}%
  \noalign{\vskip\arrayrulewidth}%
  \noalign{\global\arrayrulewidth\savedwidth}%
}

% \thickhline command for thick horizontal lines that span the table
\newcommand\thickhline{\noalign{\global\savedwidth\arrayrulewidth\global\arrayrulewidth 2pt}%
\hline
\noalign{\global\arrayrulewidth\savedwidth}}


% Remove comment for double spacing
%\usepackage{setspace}
%\doublespacing

% Text layout
\raggedright
\setlength{\parindent}{0.5cm}
\textwidth 5.25in
\textheight 8.75in

% Bold the 'Figure #' in the caption and separate it from the title/caption with a period
% Captions will be left justified
\usepackage[aboveskip=1pt,labelfont=bf,labelsep=period,justification=raggedright,singlelinecheck=off]{caption}
\renewcommand{\figurename}{Fig}

% Use the PLoS provided BiBTeX style
\bibliographystyle{plos2015}

% Remove brackets from numbering in List of References
\makeatletter
\renewcommand{\@biblabel}[1]{\quad#1.}
\makeatother



% Header and Footer with logo
\usepackage{lastpage,fancyhdr,graphicx}
\usepackage{epstopdf}
\usepackage{amsfonts}
%\pagestyle{myheadings}
\pagestyle{fancy}
\fancyhf{}
%\setlength{\headheight}{27.023pt}
%\lhead{\includegraphics[width=2.0in]{PLOS-submission.eps}}
\rfoot{\thepage/\pageref{LastPage}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrule}{\hrule height 2pt \vspace{2mm}}
\fancyheadoffset[L]{2.25in}
\fancyfootoffset[L]{2.25in}
\lfoot{\today}

%% Include all macros below

%\newcommand{\lorem}{{\bf LOREM}}
%\newcommand{\ipsum}{{\bf IPSUM}}


\newcommand{\dgf}{\Delta_fG}
\newcommand{\sdgf}{\Delta_fG^{\degree}}
\newcommand{\dgr}{\Delta_rG}
\newcommand{\sdgr}{\Delta_rG^{\degree}}
\newcommand{\bdgf}{\mathbf{\dgf}}
\newcommand{\bsdgf}{\mathbf{\sdgf}}
\newcommand{\bdgr}{\mathbf{\dgr}}
\newcommand{\bsdgr}{\mathbf{\sdgr}}

%% END MACROS SECTION


\begin{document}

\vspace*{0.2in}

% Title must be 250 characters or less.
\begin{flushleft}
{\Large
\textbf\newline{GTFA: Genrative Thermodynamic Flux Analysis} % Please use "sentence case" for title and headings (capitalize only the first word in a title (or heading), the first word in a subtitle (or subheading), and any proper nouns).
}
\newline
% Insert author names, affiliations and corresponding author email (do not include titles, positions, or degrees).
\\
Jason Jooste\textsuperscript{1},
Teddy Groves\textsuperscript{2},
Lars Nielsen\textsuperscript{2,3},
%Name4 Surname\textsuperscript{2},
%Name5 Surname\textsuperscript{2\ddag},
%Name6 Surname\textsuperscript{2\ddag},
%Name7 Surname\textsuperscript{1,2,3*},
%with the Lorem Ipsum Consortium\textsuperscript{\textpilcrow}
\\
\bigskip
\textbf{1} Ludwig Maximlian's UniversitÃ¤t MÃ¼nchen, Munich, Bavaria, Germany
\\
\textbf{2} Novo Nordisk Foundation Center for Biosustainability, Technical University of Denmark, Kgs. Lyngby, Denmark
%\\
\textbf{3} Australian Institute for Bioengineering and Nanotechnology, University of Queensland, Brisbane, Queensland, Australia
%\\
\bigskip

% Insert additional author notes using the symbols described below. Insert symbol callouts after author names as necessary.
%
% Remove or comment out the author notes below if they aren't used.
%
% Primary Equal Contribution Note
%\Yinyang These authors contributed equally to this work.

% Additional Equal Contribution Note
% Also use this double-dagger symbol for special authorship notes, such as senior authorship.
%\ddag These authors also contributed equally to this work.

% Current address notes
%\textcurrency Current Address: Dept/Program/Center, Institution Name, City, State, Country % change symbol to "\textcurrency a" if more than one current address note
% \textcurrency b Insert second current address
% \textcurrency c Insert third current address

% Deceased author note
%\dag Deceased

% Group/Consortium Author Note
%\textpilcrow Membership list can be found in the Acknowledgments section.

% Use the asterisk to denote corresponding authorship and provide email address in note below.
%* correspondingauthor@institute.edu

\end{flushleft}
% Please keep the abstract below 300 words
\section*{Abstract}


% Please keep the Author Summary between 150 and 200 words
% Use first person. PLOS ONE authors please skip this step.
% Author Summary not valid for PLOS ONE submissions.
\section*{Author summary}

%Aim to highlight where your work fits within a broader context; present the significance or possible implications of
%your work simply and objectively; and avoid the use of acronyms and complex terminology wherever possible. The goal is
%to make your findings accessible to a wide audience that includes both scientists and non-scientists.

\linenumbers

% Use "Eq" instead of "Equation" for equation citations.
\section*{Introduction}

% TODO: Longer intro to the field in general?
Modelling of feasible intracellular fluxes has long been a key task in metabolic engineering.
If little data is available, the space of valid fluxes can be relatively large, limited only by fundamental reaction stoichiometry and mass-balance laws:
\[
    0 = S\cdot \mathbf{v} \label{eq:steady_state}
\].
If more data is available, this space can be further constrained by known kinetics and regulatory interactions of metabolic enzymes.
A single most-parsimonious solution can then be obtained, with parsiomny determined by maximising biomass production, nearness to measured data or other objective functions {TODO: Others?}.
However, it is a difficult task for these simple measures of parsimony to define true intracellular conditions from such large spaces of viable fluxes.
An alternative is to characterise the entire space of vaiable fluxes, usually with some form of sampling. {TODO: Further references here}

Methods 1,2 {TODO: Research these} were developed to sample uniformly from the space of steady-state fluxes.
Saa {TODO: Citation} extended these methods to exclude loops from the flux space, which are known to violate the 2nd law of thermodynamics.
Alternatively, one can simply include thermodynamic constraints which addresses the problem of loops while excluding further fluxes that violate thermodynamics.
In this case, for all reacitons, the Gibbs' energy of reaction ($\dgr$) must be less than 0.
In practice, the $\dgr$ of reaction $i$ is calculated as the sum of the Gibbs energy of reaction under standard conditions ($\sdgr$) and the scaled logarithm of products over reactants (\ref{eq:dgr})
\begin{align}
    \dgr_i &= \sdgr_i + RT\ln \frac{P}{R} \label{eq:dgr}
\end{align}
where $R$ is the gas constant, $T$ is the temperature and $P$ and $R$ are the concentrations of the reaction's products and reactants respectively.
Because the Gibbs energy of a reaction is a state function, the $\dgr$ and $\sdgr$ of a reaction are equivalent to the Gibbs energy of formation ($\dgf$) and standard Gibbs energy of formation ($\sdgf$) respectively of all reaction substrates, when scaled by their stoichiometries.
That is,
\[
    \sdgr_i = s_i \cdot \sdgf_i
\]
where $s_i \in \mathbb{Z}^{m_i}$ are the stoichiometries and $\sdgf \in \mathbb{R}^{m_i}$ are the standard formations energies of metabolites $1,\dots,m_i$ involved in reaction $i$.

For a set of reactions $1,\dots,r$ ($\bdgr \in \mathbb{R^r}$), this can also be written in matrix form as
\begin{align}
        \bdgr &= \bsdgr + RT \cdot S^{T}\ln{\mathbf{c}} \label{eq:dgr_vec}\\
              &= RT \cdot S^T (\sdgf + RT \ln{\mathbf{c}}) \label{eq:dgr_sdgf_vec}
\end{align}
where $\mathbf{c} \in \mathbb{R}_{+}^m$ is the concentration of all metabolites $1,\dots,m$ in $S$.
Eq~\ref{eq:dgr_vec} shows the relation between the $\dgr$ and $\sdgr$ and Eq~\ref{eq:dgr_sdgf_vec} shows how the same can be calculated with the $\sdgf$.
This formulation also nicely highlights the fact that $\dgr$, $\bsdgr$ and $\ln{\mathbf{c}}$ are linearly related.
As these values are estimated, another benefit of Eq~\ref{eq:dgr_sdgf_vec} becomes clear, namely that all combinations of $\sdgf$ produce a system that is thermodynamically consistent.
An arbitrarily chosen set of $\sdgr$ does not satisfy this property (see~\cite{noor_2013_equilibrator} for a more thorough description of this effect).

% A more natural way to incorporate this probabilistic information would be to sample parameter sets accoring to their
% likelihood. Any optimisation after this point can be by selecting the best one but balancing the likelihood of it
% being present.

Both $\mathbf{c}$ and $\sdgf$ can not be known for certain and need to be estimated, which creates a degree of uncertainty about their true values.
To account for this uncertainty, some margin of error needs to be included to ensure that the true intracellular conditions can be represented.
TMFA {TODO: Etc} define this margin of error for $\sdgr$ and metabolite concentrations by constraining them individually to fall within the 95\% confidence interval.
% TODO: Whole paragraph on the multivariate approach? It's kinda relevant.
~\cite{multiTFA} and~\cite{PTA} improve upon this approach by constraining these values to a 95\% confidence interval of their joint probability, significantly tightening the bounds on possible values.
However, both of these methods discard useful probabistic information about these parameters, effectively treating all values within the confidence interval as equally likely.
~\cite{PTA} {TODO: The exact method} addresses this problem by sampling from the space of valid thermodynamic orthants, i.e. flux directions, with the probabilty of each orthant determined by the probability of $\sdgr$ and metabolite concentrations within it.
Unfortunately, this method still restricts the space of valid concentrations and $\sdgr$ to the 95\% confidence interval, although, to the authors' knowledge, this is not necessary.
Additionally, the hit-and-run sampling method described in~\cite{PTA} requires multiple linear programming evaluations per sample, to ensure that samples satisfy steady state (Eq \ref{eq:steady_state}), which can inhibit computational performance.

In this work, I present an alternative approach to defining and sampling from the space of fluxes that satisfy both steady-state and thermodynamic constraints.
Generative Thermodynamic Flux Analysis (GTFA) is a method for sampling thermodynamically valid fluxes with respect to the probability that these fluxes match measured metabolite concentrations and standard formation energies.
We represent fluxes as a function of their $\dgr$ multiplied by a scaling factor and separate the network into a set of "fixed" and "free" fluxes.
This results in a parameter space where all combinations of parameters satisfy mass balance and thermodynamic constraints, as opposed to \cite{PTA}, where large portions of the $\dgr$ parameter space are invalid and must be avoided.
Furthermore, GTFA allows the inclusion of metabolomics, proteomics and fluxomics data.
The final output of GTFA is then a set thermodynamically-valid fluxes, which respects the probability of each of these varied data sources.

% TODO: Maybe some examples? Slower explanation of how there is probabilistic information attached to all of these measurements?

\section*{Materials and methods}

GTFA unifies metabolomics, fluxomics and enzyme proteomics data of a metabolic network in a generative statistical model.
That is, all measurements are assumed to be subject to measurement error and have true latent counterparts in the model.
Structurally, fluxes and thermodynamic data are forced to satisfy both steady state \ref{eq:steady_state} and thermodynamics.
% TODO: Which law of thermodynamics?

% TODO Ranges here?
Thermodynamic validty is ensured by representing a reaction's flux $v_i$ as a function of its Gibbs energy of reaction $\dgr_i$ scaled by the enzyme concentration $e_i$ and a scaling factor $b_i$, with $v_i>0$ and $v_i<0$ representing flux in the forward and reverse direciton respectively.
This can be represented for the entire metabolic network as follows:
\[
    \bdgr = \dgr\odot\mathbf{e}\odot\mathbf{b}
\]
where $\odot$ represents elementwise multiplication of the vectors, also known as the Hammard product.

\subsection{Estimation of $\sdgf$}
\subsubsection{Rank degenerate covariance matrix and Cholesky decomposition}

\subsection{GTFA formulation}

\subsubsection{$\sdgf$ priors and change of variables}

\subsubsection{Reduicing degrees of freedom by fixing paramters}

% Flux, b and dgr are LINEAR functions of one another

\subsubsection{}

\subsection{Datasets}

\subsubsection{Toy example}

\subsubsection{Gollub dataset}
% Need more info here

% Results and Discussion can be combined.
\section*{Results}

\subsection{The effect of change of variables}

\subsection{Speed comparison}

\subsection{}

\section*{Discussion}

% GTFA in the context of a pre-processing step before kinetic modelling
% We are trying to unify many sources of information.
% If we represent the results with (eg) a normal distribution, why not use variational inferece?
%

\subsection{Future work}
% Could gtfa work without fluxomics data - i.e. to predict fluxes?
% Inclusion of fluxomics data directly - forward and reverse data
% Inclusion of predictive model into bayesian model? Can you develop a machine learning method of learning latent paramters?
%

\section*{Conclusion}

% TODO: Remove this eventually
\bibliography{bibliography}

\section*{Supporting information}

% Include only the SI item label in the paragraph heading. Use the \nameref{label} command to cite SI items in the text.
%\paragraph*{S1 Fig.}
%\label{S1_Fig}
%{\bf Bold the title sentence.} Add descriptive text after the title of the item (optional).

\section*{Acknowledgments}

\nolinenumbers

% Either type in your references using
% \begin{thebibliography}{}
% \bibitem{}
% Text
% \end{thebibliography}
%
% or
%
% Compile your BiBTeX database using our plos2015.bst
% style file and paste the contents of your .bbl file
% here. See http://journals.plos.org/plosone/s/latex for
% step-by-step instructions.



\end{document}

%------------------------------------------------------------------------------------------------------------------------
% EXAMPLES
% Place figure captions after the first paragraph in which they are cited.
%\begin{figure}[!h]
%\caption{{\bf Bold the figure title.}
%Figure caption text here, please use this space for the figure panel descriptions instead of using subfigure commands. A: Lorem ipsum dolor sit amet. B: Consectetur adipiscing elit.}
%\label{fig1}
%\end{figure}
%% For figure citations, please use "Fig" instead of "Figure".
%
%
%% Place tables after the first paragraph in which they are cited.
%\begin{table}[!ht]
%\begin{adjustwidth}{-2.25in}{0in} % Comment out/remove adjustwidth environment if table fits in text column.
%\centering
%\caption{
%{\bf Table caption Nulla mi mi, venenatis sed ipsum varius, volutpat euismod diam.}}
%\begin{tabular}{|l+l|l|l|l|l|l|l|}
%\hline
%\multicolumn{4}{|l|}{\bf Heading1} & \multicolumn{4}{|l|}{\bf Heading2}\\ \thickhline
%$cell1 row1$ & cell2 row 1 & cell3 row 1 & cell4 row 1 & cell5 row 1 & cell6 row 1 & cell7 row 1 & cell8 row 1\\ \hline
%$cell1 row2$ & cell2 row 2 & cell3 row 2 & cell4 row 2 & cell5 row 2 & cell6 row 2 & cell7 row 2 & cell8 row 2\\ \hline
%$cell1 row3$ & cell2 row 3 & cell3 row 3 & cell4 row 3 & cell5 row 3 & cell6 row 3 & cell7 row 3 & cell8 row 3\\ \hline
%\end{tabular}
%\begin{flushleft} Table notes Phasellus venenatis, tortor nec vestibulum mattis, massa tortor interdum felis, nec pellentesque metus tortor nec nisl. Ut ornare mauris tellus, vel dapibus arcu suscipit sed.
%\end{flushleft}
%\label{table1}
%\end{adjustwidth}
%\end{table}